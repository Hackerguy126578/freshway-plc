<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Freshway PLC Staff Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body onload="loadProfile()">
  <div class="dashboard">
    <header>
      <h1>Freshway PLC Staff Dashboard</h1>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </header>

    <section class="profile">
      <h2>Your Profile</h2>
      <p><strong>Username:</strong> <span id="robloxUsername">Loading...</span></p>
      <p><strong>Role:</strong> <span id="robloxRole">Loading...</span></p>
    </section>

    <section class="actions">
      <button onclick="location.href='shift-planning.html'">Shift Planning</button>
      <button onclick="location.href='send-loa.html'">Send LOA</button>
      <button onclick="location.href='admin-dashboard.html'">Admin Dashboard</button>
      <button onclick="location.href='view-profiles.html'">View Profiles</button>
    </section>
  </div>

  <script>
    const groupId = 13882588; // Freshway PLC group

    function logout() {
      localStorage.removeItem("robloxUsername");
      window.location.href = "index.html";
    }

    async function loadProfile() {
      const username = localStorage.getItem("robloxUsername");
      if (!username) {
        alert("You must log in first!");
        window.location.href = "index.html";
        return;
      }

      document.getElementById("robloxUsername").textContent = username;

      try {
        const userRes = await fetch(`https://api.roblox.com/users/get-by-username?username=${username}`);
        const userData = await userRes.json();

        if (userData.errorMessage) {
          document.getElementById("robloxRole").textContent = "User not found.";
          return;
        }

        const userId = userData.Id;

        const rankRes = await fetch(`https://groups.roblox.com/v1/users/${userId}/groups/roles`);
        const rankData = await rankRes.json();

        const groupInfo = rankData.data.find(g => g.group.id === groupId);
        if (!groupInfo) {
          document.getElementById("robloxRole").textContent = "Not in Freshway PLC group.";
          return;
        }

        document.getElementById("robloxRole").textContent = `${groupInfo.role.name} (Rank ${groupInfo.role.rank})`;

      } catch (error) {
        console.error(error);
        document.getElementById("robloxRole").textContent = "Error loading role.";
      }
    }
  </script>
</body>
</html>

